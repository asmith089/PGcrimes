<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> PG Crimes </title>

    <script defer src="js/script.js"></script>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
</head>
<body>
    <div class="nav">
    
        <ol><a class="highlightCurrentPage" href="index.html">Home</a></ol>
        <ol><a href="about.html">About</a></ol>
        <ol><a href="data.html">Data</a></ol>
        <ol><a href="form.html">Contact Us</a></ol>
    </div>

      <h1>Welcome to PG Crime! </h1>
<script>
        let busRouteURL = "https://data.princegeorgescountymd.gov/resource/wb4e-w4nf.json"
    fetch(busRouteURL)
    .then((response) => {
        return response.json();
    })
    .then((routes) => {
        console.log(routes.length);

        // loop through all json object
        //   for (i = 0; i < routes.length; i++){
        //       console.log(routes[i].title);
        //   }

        // filter with exact name
        // let filtered = routes.filter(a => a.title == "109 River Road");
        // console.log(filtered);

        // let name = routes[0].title;
        // for(index in name){
        //     if(name[index].toUpperCase == "PARK"){
        //         console.log(name);
        //     }
        //     else{
        //         console.log(name[index]);
        //     }
        // }

    })
    .catch((err) => {
        console.log(err);
        main.innerHTML = "Invalid bus route";
    });

/********** SEARCH ************* */

const routeArray = [];

fetch(busRouteURL)
    .then(blob => blob.json())
    .then(data => {
        for (i = 0; i < data.length; i++) {
            if (typeof data[i].street_address != "undefined") {
                //console.log("good");
                routeArray.push(data[i]);
            }
            else {
                console.log("id: " + i);
            }
        }
        console.log(routeArray.length);
    })
function findMatches(wordToMatch, arr) {
    return arr.filter(item => {
        const regex = new RegExp(wordToMatch, 'gi');
        return item.street_address.match(regex) || item.clearance_code_inc_type.match(regex)


    });
}

function displayMatches() {
    //if(document.querySelector('#searchin').value != ""){
    suggestions.innerHTML = "<tr><th>Case ID</th><th>Date</th><th>Crime Type</th><th>Street Address</th></tr>";
    const monthNames = ["Jan.", "Feb.", "Mar.", "Apr.", "May", "Jun.",
    "Jul.", "Aug.", "Sep.", "Oct.", "Nov.", "Dec."];
    const matchArray = findMatches(searchInput.value, routeArray);
    const html = matchArray.map(mission => {
        let date = new Date(mission.date)

        //const regex = new RegExp(this.value, 'gi');
        //const missionName = mission.taskName.replace(regex, `<span class="highlight">${this.value}</span>`);
        return `
        <tr>
            <td>${mission.incident_case_id}</td>
            <td>${monthNames[date.getMonth()] +" "+ date.getDate() +" "+ date.getFullYear()}</td>
            <td>${mission.clearance_code_inc_type}</td>
            <td>${mission.street_address}</td>
        </tr>
      `;
    }).join('');
    suggestions.innerHTML += html;
}
//else{
// suggestions.innerHTML = "";
//}
//}

const searchInput = document.querySelector('#searchin');
const suggestions = document.querySelector('.suggestions');
const searchBtn = document.querySelector('#btngo');

//searchInput.addEventListener('change', displayMatches);
//searchInput.addEventListener('keyup', displayMatches);
searchBtn.addEventListener('click', displayMatches);
searchInput.addEventListener("keyup", function(event) {
    // Number 13 is the "Enter" key on the keyboard
    if (event.keyCode === 13) {
      // Cancel the default action, if needed
      event.preventDefault();
      // Trigger the button element with a click
      document.getElementById("btngo").click();
    }
  }); 

    </script>
    </body>
    </html>
      